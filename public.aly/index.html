<!doctype html>
<html>
  
  <head>
     <script src="client.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <style>
      tr td {
        width: 20px;
        height: 20px;
      }
      .left {
        float: left;
      }
    </style>
  </head>
  
  <body>
     
    <table class="left" id="board1" cellspacing=0 cellpadding=0 border=1 style="border-collapse:collapse;"></table>
    <table class="left" id="preBoard1" cellspacing=0 cellpadding=0 border=1 style="border-collapse:collapse;"></table>
    <script>
       function fillTable(id,w,h){
        var data = new Array();
        for (var i = 0; i < h; i++) {
          data.push('<tr>');
          for (var j = 0; j < w; j++) {
           data.push('<td></td>');
          }
          data.push('</tr>');
         }
          document.getElementById(id).innerHTML = data.join('');
      }
  
      fillTable('board1',10,20);
      fillTable('preBoard1',4,4);
      //键盘控制
    function keyControl(event) {
        var code = event.keyCode;
        socket.emit('op',code-37);
    }
     function play(){
       socket.emit('play');
     }
     
     var socket = io.connect('');
      document.onkeydown = keyControl;
      var shadow = new Shadow(1);
      socket.message = function(msg,id){
        if(socket.id!=id){
          document.getElementById('msg').innerHTML = '<p style="color:blue">'+msg+'</p>';
        }else{
          document.getElementById('msg').innerHTML = '<p style="color:red">'+msg+'</p>'
        }
      };
      socket.on('start',function(id){
         socket.message(id+'开始了游戏',id);
      });
      socket.on('control',function(id){
        
        if(id){
           socket.message(id+'控制了游戏',id);
        }else{
           socket.message('当前无人控制游戏',id);
        }
       
      });
      socket.on('uncontrol',function(id){
        socket.message(id+'丢失了游戏',id);
      });
      socket.on('cdata',function(data){
        var success = shadow.fromCompress(data);
        if(success)shadow.update();
      });
      socket.on('score',function(score){
        if(score){
          document.getElementById('score').innerHTML = '<p style="color:red">'+score[1]+'</p>'
        }
       
      });
       
    </script>
    <button onclick="play()">play</button>
    <a href="record.html">观看最高分录像</a>
    <div id="score"></div>
    <div id="msg"></div>
  </body>

</html>